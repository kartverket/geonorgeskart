// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://@sbaseurl@/jsapi/jsapi/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(A,w,p,n,a,k,t,x){function K(a,b){this.start=a;this.end=b}function l(a,b,h){this.start=a;this.end=b;this.units=h}function d(a,b){this.start=a;this.end=b;this.temp=new n}function u(a){this.values=a;this.length=a.length}function z(a,b){this.values=a;this.def=b?b:{}}function N(a,b){this.stack=a;this.original=b}function q(a,
b,h,k){if(a.values)return new u(a.values);var r,G;G=a.start?w.normalizeColor(a.start):r=b?h?b[h]:b:k;a.end?a=w.normalizeColor(a.end):(r||(r=b?h?b[h]:b:k),a=r);return new d(G,a)}var y=w.fx={};K.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};l.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};d.prototype.getValue=function(a){return n.blendColors(this.start,this.end,a,this.temp)};u.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*
this.length),this.length-1)]};z.prototype.getValue=function(a){var b=A.clone(this.def),h;for(h in this.values)b[h]=this.values[h].getValue(a);return b};N.prototype.getValue=function(d){var b=[];a.forEach(this.stack,function(h){if(h instanceof p.Matrix2D)b.push(h);else if("original"==h.name&&this.original)b.push(this.original);else if("matrix"==h.name){if(h.start instanceof p.Matrix2D&&h.end instanceof p.Matrix2D){var k=new p.Matrix2D,r;for(r in h.start)k[r]=(h.end[r]-h.start[r])*d+h.start[r];b.push(k)}}else h.name in
p&&(k=p[h.name],"function"!=typeof k?b.push(k):(r=a.map(h.start,function(a,b){return(h.end[b]-a)*d+a}),k=k.apply(p,r),k instanceof p.Matrix2D&&b.push(k)))},this);return b};var B=new n(0,0,0,0);y.animateStroke=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),h=a.shape,d;t.connect(b,"beforeBegin",b,function(){d=h.getStroke();var b=a.color,k={},l;b&&(k.color=q(b,d,"color",B));if((b=a.style)&&b.values)k.style=new u(b.values);if(b=a.width){var n=b;n.values?l=new u(n.values):(b=
n.start?n.start:l=d?d.width:1,n.end?l=n.end:"number"!=typeof l&&(l=d?d.width:1),l=new K(b,l));k.width=l}if((b=a.cap)&&b.values)k.cap=new u(b.values);if(b=a.join)b.values?k.join=new u(b.values):(l=b.start?b.start:d&&d.join||0,b=b.end?b.end:d&&d.join||0,"number"==typeof l&&"number"==typeof b&&(k.join=new K(l,b)));this.curve=new z(k,d)});t.connect(b,"onAnimate",h,"setStroke");return b};y.animateFill=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),d=a.shape,l;t.connect(b,"beforeBegin",
b,function(){l=d.getFill();var b=a.color;b&&(this.curve=q(b,l,"",B))});t.connect(b,"onAnimate",d,"setFill");return b};y.animateFont=function(a){a.easing||(a.easing=k._defaultEasing);var b=new k.Animation(a),d=a.shape,n;t.connect(b,"beforeBegin",b,function(){n=d.getFont();var b=a.style,k={},p,t;b&&b.values&&(k.style=new u(b.values));if((b=a.variant)&&b.values)k.variant=new u(b.values);if((b=a.weight)&&b.values)k.weight=new u(b.values);if((b=a.family)&&b.values)k.family=new u(b.values);if((b=a.size)&&
b.units)p=parseFloat(b.start?b.start:d.font&&d.font.size||"0"),t=parseFloat(b.end?b.end:d.font&&d.font.size||"0"),k.size=new l(p,t,b.units);this.curve=new z(k,n)});t.connect(b,"onAnimate",d,"setFont");return b};y.animateTransform=function(d){d.easing||(d.easing=k._defaultEasing);var b=new k.Animation(d),h=d.shape,l;t.connect(b,"beforeBegin",b,function(){l=h.getTransform();this.curve=new N(d.transform,l)});t.connect(b,"onAnimate",h,"setTransform");if("svg"===w.renderer&&(9<=x("ie")||x("ff")))var n=
[t.connect(b,"onBegin",b,function(){for(var a=h.getParent();a&&a.getParent;)a=a.getParent();a&&(h.__svgContainer=a.rawNode.parentNode,h.__svgRoot=a.rawNode,h.__svgRoot&&h.__svgRoot.getAttribute&&(h.__svgWidth=parseInt(h.__svgRoot.getAttribute("width"),10),isNaN(h.__svgWidth)&&delete h.__svgWidth))}),t.connect(b,"onAnimate",b,function(){try{if(h.__svgContainer){var a=h.__svgContainer.style.visibility;h.__svgContainer.style.visibility="visible";h.__svgContainer.style.visibility=a;var b=h.__svgWidth;
if(!isNaN(b))try{h.__svgRoot.setAttribute("width",b-5E-6),h.__svgRoot.setAttribute("width",b)}catch(d){}}}catch(k){}}),t.connect(b,"onEnd",b,function(){a.forEach(n,t.disconnect);if(h.__svgContainer){var b=h.__svgContainer;if(null==b.getAttribute("__gotVis")){b.setAttribute("__gotVis",!0);var d=h.__svgContainer.style.visibility,k=h.__svgRoot,l=h.__svgWidth;b.style.visibility="visible";setTimeout(function(){try{b.style.visibility=d;b.removeAttribute("__gotVis");b=null;try{isNaN(l)||(k.setAttribute("width",
l-5E-6),k.setAttribute("width",l))}catch(a){}}catch(h){}},100)}}delete h.__svgContainer;delete h.__svgRoot;delete h.__svgWidth})];return b};return y})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/request esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(A,w,p,n,a,k,t,x,K,l,d,u,z,N,q,y,B,S,b,h,T,r,G,C,H,R,D,L,V){return A("ClusterLayer",[N,u],{constructor:function(e){this.clusterGraphics=null;this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=[];this.hidePanel=e.hidePanel;this._parent=e._parent;if(this._parentLayer=e.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=e.name;this._map=e.map;this.color=a.fromString(e.color||"#ff0000");
this._styleColor=e._styleColor;this.symbolData=e.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=e.lyrInfo.itemId;this.refresh=e.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=e.node;this.countEnabled=e.countEnabled;this.legendNode=e.legendNode;this.id=e.id;this.infoTemplate=e.infoTemplate;this.url=e.lyrInfo.url;this._testRenderer=e.lyrInfo.renderer;(this.originOperLayer=e.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);
this.lyrInfo=e.lyrInfo;this.lyrType=e.lyrType;this.filter=e.filter;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(n.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(e){var a=new H;a.geometry=this._map.extent;e.queryCount?e.queryCount(a,n.hitch(this,function(a){if(0<a)this.hidePanel||(this.nodeCount=a),this._initFeatures(this._parentLayer);else if(!this.hidePanel){this.nodeCount=
0;var b=new V(e.url);d(b,"load",n.hitch(this,function(){this.countFeatures(b)}))}})):this._initFeatures(this._parentLayer)},_initFeatures:function(e){this._features=[];var a=!0,b=new H;-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||null===this.url?(this._getSourceFeatures(e.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(b.where=this.filter?this.filter:"1\x3d1",b.outFields=this._fieldNames,b.returnGeometry=!0,e.queryFeatures?e.queryFeatures(b).then(n.hitch(this,
function(e){e.features&&(this._getSourceFeatures(e.features),this.clusterFeatures())})):a="error");"error"!==a&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",n.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",n.hitch(this,this.handleClick))))},_getSourceFeatures:function(e){this._features=[];for(var a=0;a<e.length;a++){var b=e[a];b.geometry&&this._features.push(b)}},_getInfoTemplate:function(e){e=e.parentLayerInfo?e.parentLayerInfo:
e;if(e.controlPopupInfo&&(e=e.controlPopupInfo.infoTemplates)){if(this.url){var a=this.url.split("/").pop();a&&(e.indexOf?-1<e.indexOf(a)&&(this.infoTemplate=e[a].infoTemplate):e.hasOwnProperty(a)&&(this.infoTemplate=e[a].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var e=this.infoTemplate.info.fieldInfos;if(e)for(var a=0;a<e.length;a++)e[a].visible&&this._fieldNames.push(e[a].fieldName)}if(this.symbolData.featureDisplayOptions&&
0<this.symbolData.featureDisplayOptions.fields.length)for(e=0;e<this.symbolData.featureDisplayOptions.fields.length;e++)a=this.symbolData.featureDisplayOptions.fields[e],-1===this._fieldNames.indexOf(a.name)&&this._fieldNames.push(a.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(e){this.lyrInfo=e},clearSingles:function(e){w.forEach(e||this._singles,function(e){this.remove(e)},this);this._singles.length=0},_getSingleGraphic:function(e){e=new q(new B(e.geometry.x,e.geometry.y,
this._map.spatialReference),null,e.attributes);e.setSymbol(this._singleSym);return e},_addSingles:function(e){w.forEach(e,function(e){e=this._getSingleGraphic(e);this._singles.push(e);this._showSingles&&this.add(e)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(e){if(!this.hidePanel){var a=new H;a.returnGeometry=!1;a.geometry=this._map.extent;a.where=this.filter?this.filter:"1\x3d1";(new R(e)).executeForIds(a).then(n.hitch(this,function(e){var a;this.node?(x.contains(this.node,
"searching")&&x.remove(this.node,"searching"),this.node.innerHTML=e?z.localizeNumber(e.length):0,a=this.node.parentNode):this.legendNode&&(a=this.legendNode.previousSibling);this.updateExpand(a,e?!1:!0)}))}},updateExpand:function(e,a){if(!this.hidePanel&&"undefined"!==typeof e){var b;-1<e.id.indexOf("rec_")&&(b=e.id.replace("rec_",""),b=K.byId("exp_"+b));a?(e&&(k.addClass(e,"recDefault"),k.addClass(e,"inActive")),b&&k.addClass(b,"expandInActive")):(e&&(k.removeClass(e,"recDefault"),k.removeClass(e,
"inActive")),b&&k.removeClass(b,"expandInActive"))}},loadData:function(e){if(0<e.length){this.initalCount(e);var a=new H;a.where="1\x3d1";this.filter&&(a.where=this.filter);a.returnGeometry=!1;this.queryPending=!0;(new R(e)).executeForIds(a).then(n.hitch(this,function(a){if(a){this.queryIDs=a;a=[];var b,d;b=0;for(d=this.queryIDs.length;b<d;b+=1E3){var k=this.queryIDs.slice(b,b+1E3);a.push(C({url:e+"/query",content:{f:"json",outFields:this._fieldNames.join(),objectids:k.join(),returnGeometry:"true",
outSR:this._map.spatialReference.wkid}}))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new t(a)).then(n.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var g=this._map.spatialReference,s=[],c=0;c<a.length;c++)if(a[c][1].features)for(var m=0;m<a[c][1].features.length;m++){var f=a[c][1].features[m];if("undefined"!==typeof f.geometry){var e=new B(f.geometry.x,f.geometry.y,g),e=new q(e);e.setAttributes(f.attributes);
this.infoTemplate&&e.setInfoTemplate(this.infoTemplate);s.push(e)}}a=!0;1E4>s&&(a=JSON.stringify(this._features)!==JSON.stringify(s));a&&(this._features=s,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},handleClick:function(a){var b=[];if(a.graphic&&(b=a.graphic,b.attributes)){var d=b.attributes;d.Data&&1<d.Data.length?(this.clearSingles(this._singles),b=d.Data,a.stopPropagation(),this._addSingles(b)):d.Data&&1===d.Data.length?(d.Data[0].symbol=b.symbol,this._map.infoWindow.setFeatures([d.Data[0]])):
this._map.infoWindow.setFeatures([b])}this.infoTemplate&&this._map.infoWindow.show(a.mapPoint);p.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();else if(a.delta){var b=a.delta;a=Math.abs(b.x);b=Math.abs(b.y);(50<a||50<b)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;"undefined"===typeof this.updateFeatures&&(this.updateFeatures=a);var b=!0;1E4>a.length&&(b=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(b){this._features=
[];this._parentLayer.clear();var b=this._parentLayer.spatialReference,d;this._parentLayer.renderer?d=this._parentLayer.renderer:this._testRenderer&&(d=this._testRenderer);for(var k=0;k<a.length;k++){var h=a[k];if(h.geometry){var l=new q(this.getGraphicOptions(h,b,d));l.setAttributes(h.attributes);this.infoTemplate&&l.setInfoTemplate(this.infoTemplate);l.setSymbol(d.getSymbol(l));this._parentLayer.add(l);this._features.push(l)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=
a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,b,d){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new B(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:d.symbol}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},flashSingle:function(e){if("undefined"===
typeof e.symbol){var d=new h(h.STYLE_NULL,new a(0,0,0,0),0),k=this.color.toRgb();e.setSymbol(new b(b.STYLE_CIRCLE,9,d,new a([k[0],k[1],k[2],0.5])))}this.flashGraphics([e])},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b]);setTimeout(n.hitch(this,this._clearFeatures),1100)},_flashFeature:function(e){var d;if(e.geometry){var k=a.fromHex(this._styleColor),p=n.clone(k);p.a=0.4;"undefined"!==typeof e.symbol&&(d=new b(b.STYLE_CIRCLE,e.symbol.size,new h(h.STYLE_SOLID,k,1),p))}if("undefined"!==
typeof d&&(e=new q(e.geometry,d),this._map.graphics.add(e),d=e.getDojoShape()))l.animateStroke({shape:d,duration:700,color:{start:d.strokeStyle.color,end:d.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,e)},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(a){a.getLayer().remove(a)},setColor:function(a){this.color=a},setStyleColor:function(a){this._styleColor=a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&
(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var a=this._features,b=0;if("undefined"!==typeof a){if(0<a.length&&this.visible){var d=this.clusterSize;this.clusterGraphics=
[];for(var k=this._map.spatialReference,h=this._map.extent,l=new B(h.xmin,h.ymax,k),n=Math.ceil(this._map.height/d),g=Math.ceil(this._map.width/d),s=h.getWidth()/this._map.width*d,d=h.getHeight()/this._map.height*d,h=0;h<n;h++)for(var c=0;c<g;c++){var m=l.x+s*c,f=l.y-d*h,f=new y(m,f-d,m+s,f,k),m=[],O;for(O in a){var Y=a[O];f.contains(Y.geometry)&&(b+=1,m.push(Y))}0<m.length&&(f=this.getClusterCenter(m),this.clusterGraphics.push({center:f,graphics:m}))}for(var ba in this.clusterGraphics){a=this.clusterGraphics[ba];
k=a.graphics.length;l=a.graphics;s=z.localizeNumber(k);g=n=19*s.length;n+=5;O=new r;O.family="Arial";O.size="16px";s=new T(s,O,this.countColor);s.setOffset(0,-4);var I;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?I=this.symbolData.symbol.size:this.symbolData.symbol.width&&(I=this.symbolData.symbol.width,O=this.symbolData.symbol.height,I=I>=O?I:O):this.icon.width?(n=this.icon.width>=n?this.icon.width+5:n,n=this.icon.height>=n?this.icon.height+5:n,g=this.icon.width>=g?this.icon.width+
1:g,g=this.icon.height>=g?this.icon.height+1:g):this.icon.size&&(I=this.icon.size);I&&(n=I>=n?I+5:n,g=I>=g?I+1:g);g>=n&&(n+=0===g-n?4:g-n+5);this._setSymbols(n+15,n);l={Count:k,Data:l};1<k?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new q(a.center,this.csym,l)),this.displayFeatureCount?this.add(new q(a.center,s,l)):this.add(new q(a.center,this.csym3,l))):(this.add(new q(a.center,this.csym,l)),this.displayFeatureCount?this.add(new q(a.center,s,l)):this.add(new q(a.center,
this.psym,l))):(this.add(new q(a.center,this.csym,l)),this.displayFeatureCount?this.add(new q(a.center,s,l)):this.add(new q(a.center,this.psym,l))):(a=a.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new q(a,null,l.Data[0].attributes,this.infoTemplate),a.setSymbol(this.renderer.getSymbol(a))):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new q(a,null,l.Data[0].attributes,this.infoTemplate),
a.setSymbol(D.fromJson(this.renderer.symbol))):a="EsriSymbol"===this.symbolData.symbolType?new q(a,D.fromJson(this.symbolData.symbol),l,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new q(a,this.psym,l,this.infoTemplate):this.renderer.symbol?new q(a,this.renderer.symbol,l,this.infoTemplate):new q(a,this.psym,l,this.infoTemplate),"undefined"!==typeof a&&this.add(a)))}}this._updateNode(b)}},_getSym:function(a){var b;this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?
b=this.renderer.getSymbol(a):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?b=this.renderer.symbol:"EsriSymbol"===this.symbolData.symbolType?b=this.symbolData.symbol:this.symbolData.symbol&&(b=this.symbolData.symbol);return b},_updateNode:function(a){if(!this.hidePanel){var b;this.node?(this.node.innerHTML=a?z.localizeNumber(a):0,b=this.node.parentNode):this.legendNode&&(b=this.legendNode.previousSibling);this.updateExpand(b,a&&this.visible?!1:!0)}},_updatePanelTime:function(a){if(!this.hidePanel){this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e";var b="";""!==this.config.mainPanelText&&(b=this.config.mainPanelText+" ");this.pageTitle.innerHTML=b+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}},_setSymbols:function(d,k){var l=this.color.toRgb(),p,t,q;if("undefined"!==typeof this.symbolData){var r;"custom"===this.backgroundClusterSymbol?r=l:(p=D.fromJson(this.backgroundClusterSymbol),0===p.outline.color.a||0===p.outline.width?
(t=h.STYLE_NULL,q=0):(t=h.STYLE_SOLID,q=p.outline.width));p?(l=h(t,p.outline.color,q),r=p.color.toRgb(),this.csym=new b(b.STYLE_CIRCLE,d,l,new a([r[0],r[1],r[2],0.75]))):this.csym=new b(b.STYLE_CIRCLE,d,null,new a([r[0],r[1],r[2],0.75]));(l=(l=this.symbolData.s)&&-1<l.indexOf("${appPath}")?this.symbolData.s.replace("${appPath}",window.location.origin+window.location.pathname):this.symbolData.s?this.symbolData.s:this.icon.imageData)&&"CustomIcon"===this.symbolData.iconType?this.psym=new S(l,d-6,d-
6):l&&"LayerIcon"===this.symbolData.iconType?this.psym=D.fromJson(this.symbolData.symbol):(l=h(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),this.psym=new b(this.icon.style,this.icon.size,l,this.icon.color));this.csym2=n.clone(this.psym);this.csym3=n.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else p=new h(h.STYLE_NULL,new a(0,0,0,0),0),this.csym=new b(b.STYLE_CIRCLE,d,
p,new a([l[0],l[1],l[2],0.5])),this.psym=new S(this.icon.url,d-10,d-10),this.psym2=new S(this.icon.url,k-7,k-7),p=new h(h.STYLE_NULL,new a(0,0,0,0),0),this.csym2=new b(b.STYLE_CIRCLE,k,p,new a([l[0],l[1],l[2],0.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=
this._parentLayer.renderer.toJson?this._parentLayer.renderer:L.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=L.fromJson(this._testRenderer):this.symbolData.renderer&&(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:L.fromJson(this.symbolData.renderer)):this.renderer=new G(D.fromJson(this.symbolData.symbol));var d=this.color.toRgb(),k=new h(h.STYLE_NULL,new a(0,0,0,0),0);this._singleSym=new b(b.STYLE_CIRCLE,9,k,new a([d[0],d[1],d[2],0.5]))}},getLayer:function(){return this},
getClusterCenter:function(a){var b=0,d=0,k=a.length;w.forEach(a,function(a){b+=a.geometry.x;d+=a.geometry.y},this);return new B(b/k,d/k,a[0].geometry.spatialReference)},destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.loadData(this.url)}})})},"widgets/InfoSummary/js/ThemeColorManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/_base/array","dojo/_base/Color"],function(A,
w,p,n,a){return A(null,{_theme:null,_styleName:"",_styleColor:null,_options:null,constructor:function(a){this._theme=a.theme;this._styleName=a.stylename;this.getStyleColor(this._styleName);this._options=a;this.ph=a.ph;this.w=a.w},setStyle:function(a){this._styleName=a;this.getStyleColor(this._styleName)},getStyleColor:function(){setTimeout(w.hitch(this,function(){var k=this.w.getComputedStyle(this.ph,null).getPropertyValue("background-color");this._styleColor=a.fromRgb(k).toHex()}),500)},updateUI:function(a){a&&
n.forEach(this._options.updateNodes,function(n){p.set(n.node,n.styleProp,a)})}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop jimu-main-background" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 5px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor:pointer; vertical-align:middle; -webkit-border-radius:10px; -moz-border-radius:10px; -o-border-radius:10px; -ms-border-radius:10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .featureItem:hover{background-color: lightgray;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 210px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 10px; top: 10px; background: url(../images/x.png) no-repeat; cursor: pointer; width: 12px; height: 12px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 210px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 190px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor:pointer;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; color: #000000; display: table-cell; width: auto; height: 100%; padding-right: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; color: #000000; display: table-cell; width: auto; height: 100%; padding-left: 10px;}.jimu-widget-InfoSummary .inActive {opacity:0.6; filter:alpha(opacity\x3d60);}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; color: #000000; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; color: #000000; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; color: #000000; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; color: #000000; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; color: #000000; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 35px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 55px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 55px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageLabel {padding-top: 10px; color: whitesmoke; font-size: 17px; text-align: center;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .imageDataGFX {width: 15px; height: 15px; display: block; float: left; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {width: 15px; height: 15px; display: block; float: right; padding-right: 10px;}.jimu-widget-InfoSummary .expandArrow {width: 100%; height: 20px;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover {background-color: #f2f2f2;}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; background-color: #f2f2f2; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; background-color: #f2f2f2; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent {} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity:0.3; filter:alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}} ",
"*now":function(A){A(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer ./js/ThemeColorManager esri/layers/LayerDrawingOptions".split(" "),function(A,
w,p,n,a,k,t,x,K,l,d,u,z,N,q,y,B,S,b,h,T,r,G,C,H,R,D,L,V,e,U,Z,$,aa,W,X){return K([A,b],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],postCreate:function(){this.inherited(arguments);this.configLayerInfos=this.config.layerInfos;this.layerList={};this._initWidget()},startup:function(){this.inherited(arguments);
this.hidePanel||(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),this._mapExtentChange())},onOpen:function(){this.widgetChange=!1;this.hidePanel||this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);var g=[],a;for(a in this.layerList){var c=this.layerList[a],m=c.li,f=c.layerObject;if(m&&m.orgRenderer){if(f.setRenderer)f.setRenderer(m.newRenderer);else if(f.setLayerDrawingOptions){var b=
[],d=new X;d.renderer=m.newRenderer;b[m.subLayerId]=d;f.setLayerDrawingOptions(b)}else console.log("Error setting the new renderer...will use the default rendering of the layer");f.refresh()}var e;f&&f.layerInfos?e=f:m&&"undefined"!==typeof m.parentLayerID&&(e=this.map.getLayer(m.parentLayerID));if(e&&e.visibleLayers){f=!1;b=0;b:for(;b<g.length;b++)if(g[b].id===e.id){f=!0;break b}(0===g.length||!f)&&g.push({id:e.id,layers:e.visibleLayers});f=0;f;b:for(;f<g.length;f++)if(g[f].id===e.id)break b;b=g[f].layers;
if(e.layerInfos){if(0<e.layerInfos.length&&m&&"undefined"!==typeof m.subLayerId){var d=-1<b.indexOf(m.subLayerId),k=c.parentLayerVisible,h=c.layerObject.parentLayerVisible;"ClusterLayer"===c.type&&(d||k||h)?(c.parentLayerVisible=!0,c.layerObject.parentLayerVisible=!0,c.visible=!0,d&&b.splice(b.indexOf(m.subLayerId),1)):d||k?(c.parentLayerVisible=!0,c.visible=!0,-1===b.indexOf(m.subLayerId)&&b.push(m.subLayerId)):(c.parentLayerVisible=!1,c.visible=!1,d&&b.splice(b.indexOf(m.subLayerId),1),"ClusterLayer"===
c.type&&(c.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(c.id)&&(m=this.map.getLayer(c.id),m.setVisibility(!1))))}g[f].layers=b}this.updatePanelVisibility(c,a,c)}else f&&("ClusterLayer"===c.type&&f._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(c.id)&&(m=this.map.getLayer(c.id),"undefined"===typeof c.layerObject.parentLayerVisible&&(c.parentLayerVisible=f._parentLayer.visible,c.layerObject.parentLayerVisible=f._parentLayer.visible),m.setVisibility(c.layerObject.parentLayerVisible)),
f._parentLayer.setVisibility&&f._parentLayer.setVisibility(!1)),this.updatePanelVisibility(f,a,c))}for(a=0;a<g.length;a++)(c=this.map.getLayer(g[a].id))&&c.setVisibleLayers(g[a].layers);!this.hidePanel&&"undefined"===typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow.highlight=!0},updatePanelVisibility:function(g,s,c){if(!this.hidePanel&&
"undefined"!==typeof g.visible){var m=n.byId("recLabel_"+s);g.visible?(a.contains("recIcon_"+s,"active")||a.add("recIcon_"+s,"active"),this.config.countEnabled&&a.contains("recNum_"+s,"recNumInActive")&&(a.remove("recNum_"+s,"recNumInActive"),a.add("recNum_"+s,"recNum")),m&&m.firstChild&&a.remove(m.firstChild,"inActive"),a.contains("exp_"+s,"expandInActive")&&a.remove("exp_"+s,"expandInActive"),a.contains("rec_"+s,"recDefault")&&a.remove("rec_"+s,"recDefault")):(a.contains("recIcon_"+s,"active")&&
a.remove("recIcon_"+s,"active"),this.config.countEnabled&&a.contains("recNum_"+s,"recNum")&&(a.remove("recNum_"+s,"recNum"),a.add("recNum_"+s,"recNumInActive")),m&&m.firstChild&&a.add(m.firstChild,"inActive"),a.contains("exp_"+s,"expandInActive")||a.add("exp_"+s,"expandInActive"),c.toggleLegend.remove(),a.contains("rec_"+s,"rec")&&a.add("rec_"+s,"recDefault"))}},enableRefresh:function(){var g=null,a=!1,c;for(c in this.layerList){g=this.layerList[c];if("ClusterLayer"!==g.type)!a&&g.li&&g.li.itemId&&
(e.getItem(g.li.itemId).then(l.hitch(this,this._updateItem)),a=!0),g=g.layerObject;else for(var m=0;m<this.opLayers.length;m++){var f=this.opLayers[m];if(f.layerObject){g=f.layerObject;break}}g&&(g.refreshInterval=this.config.refreshInterval)}g=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=g,this.refreshInterval=setInterval(l.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==
g&&(this.refreshIntervalValue=g,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(l.hitch(this,this.refreshLayers),this.refreshIntervalValue))},_updatePanelTime:function(g){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=p.fieldFormatter.getFormattedDate(new Date(g),{dateFormat:"shortDateShortTime"}))},refreshLayers:function(){for(var g in this.layerList){var a=this.layerList[g],c;a.li&&a.li.itemId?c=a.li.itemId:
a.layerObject.itemId&&(c=a.layerObject.itemId);c&&-1===this.currentQueryList.indexOf(c)&&(this.currentQueryList.push(c),e.getItem(c).then(l.hitch(this,this._updateItem)))}},_updateItem:function(g){var a=!0;this.lastModifiedTime&&(a=this.lastModifiedTime<g.item.modified);if(a){this._updatePanelTime(g.item.modified);for(var a=g.itemData,c=0;c<a.layers.length;c++)this._updateLayerItem(a.layers[c],g.item.modified)}this.currentQueryList.splice(this.currentQueryList.indexOf(g.item.id),1);this.lastModifiedTime=
g.item.modified},_updateLayerItem:function(g){var a,c,m;for(m in this.layerList)if(this.layerList[m].pl&&this.layerList[m].pl.layerDefinition){if(this.layerList[m].pl.layerDefinition.name===g.layerDefinition.name){a=this.layerList[m];c=a.pl;break}}else this.layerList[m].layerObject._parentLayer&&this.layerList[m].layerObject._parentLayer.name===g.layerDefinition.name&&(this.layerList[m].layerObject.refreshFeatures(g),this.layerList[m].layerObject&&this._loadList(this.layerList[m],!0));if(g&&c){g=
g.featureSet.features;m=c.featureSet.features;var f=!0;1E4>g.length&&(f=JSON.stringify(m)!==JSON.stringify(g));if(f){c.layerObject.clear();m=a.layerObject.spatialReference;for(f=0;f<g.length;f++){var b=g[f];if(b.geometry){var d=this.getGraphicOptions(b,m,a.layerObject.renderer),e=new h(d);e.setSymbol(d.symbol);e.setAttributes(b.attributes);this._infoTemplate&&e.setInfoTemplate(this._infoTemplate);c.layerObject.add(e)}else console.log("Null geometry skipped")}a.layerObject.refresh();c.layerObject.refresh();
c.featureSet.features=g;this.countFeatures(a);a.layerObject&&this._loadList(a,!0)}}},getGraphicOptions:function(g,a,c){return"undefined"!==typeof g.geometry.rings?{geometry:{rings:g.geometry.rings,spatialReference:{wkid:a.wkid}}}:"undefined"!==typeof g.geometry.paths?{geometry:{paths:g.geometry.paths,spatialReference:{wkid:a.wkid}}}:{geometry:new T(g.geometry.x,g.geometry.y,g.geometry.spatialReference),symbol:c.symbol}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?
this.config.hidePanel:!1;this.map.itemId&&w.getInstance(this.map,this.map.itemInfo).then(l.hitch(this,function(g){2.1<=parseFloat(this.appConfig.wabVersion)?this.supportsFilter=!0:this.supportsFilter=!1;this.opLayers=g._operLayers;this.opLayerInfos=g._layerInfos;this._createPanelUI(this.configLayerInfos,g);this.supportsFilter&&this._addFilterChanged(g)}))},_addFilterChanged:function(g){g.on("filterChanged",l.hitch(this,function(g){N.forEach(g,l.hitch(this,function(g){var a=g.id,s=g.id+this.UNIQUE_APPEND_VAL_CL;
this.layerList.hasOwnProperty(a)?this.layerList[a].filter=g.getFilter():this.layerList.hasOwnProperty(s)&&(this.layerList[s].filter=g.getFilter())}))}))},_updatePanelHeader:function(){this.pageLabel.innerHTML=p.stripHTML(this.label);x.set(this.pageLabel,"display","block");var g;g=this.map.width;this.config.displayPanelIcon&&750<g?(this.pageHeader&&(d.removeClass(this.pageHeader,"pageHeaderNoIcon"),d.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?
d.addClass(this.pageHeader,"pageHeaderRefresh"):d.addClass(this.pageHeader,"pageHeaderRefreshNoText"):d.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(d.removeClass(this.pageBody,"pageBodyNoIcon"),d.removeClass(this.pageBody,"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?d.addClass(this.pageBody,"pageBodyRefresh"):d.addClass(this.pageBody,"pageBodyRefreshNoText"):d.addClass(this.pageBody,"pageBody")),this.pageTitle&&(d.addClass(this.pageTitle,"pageTitleWidth"),
this.config.refreshEnabled?(d.removeClass(this.pageTitle,"pageTitle"),d.addClass(this.pageTitle,"pageTitleRefresh")):(d.removeClass(this.pageTitle,"pageTitleRefresh"),d.addClass(this.pageTitle,"pageTitle"))),g=this.config.mainPanelText,"undefined"===typeof g&&(g=""),this.pageTitle.innerHTML=g,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):!this.config.displayPanelIcon&&!this.config.refreshEnabled?(this.pageHeader&&(d.removeClass(this.pageHeader,"pageHeader"),d.removeClass(this.pageHeader,
"pageHeaderNoIconRefresh"),d.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(d.removeClass(this.pageBody,"pageBody"),d.removeClass(this.pageBody,"pageBodyNoIconRefresh"),d.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(d.removeClass(this.pageHeader,"pageHeader"),d.removeClass(this.pageHeader,"pageHeaderNoIcon"),
d.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(d.removeClass(this.pageBody,"pageBody"),d.removeClass(this.pageBody,"pageBodyNoIcon"),d.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&d.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&(750>=g&&this.config.refreshEnabled)&&(this.pageHeader&&(d.removeClass(this.pageHeader,"pageHeaderNoIcon"),
d.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),d.removeClass(this.pageHeader,"pageHeader"),d.addClass(this.pageHeader,"pageHeaderRefresh")),this.pageBody&&(d.removeClass(this.pageBody,"pageBodyNoIcon"),d.removeClass(this.pageBody,"pageBodyNoIconRefresh"),d.removeClass(this.pageBody,"pageBody"),d.addClass(this.pageBody,"pageBodyRefresh")),this.pageTitle&&d.addClass(this.pageTitle,"pageTitleWidth"),g=this.config.mainPanelText,"undefined"===typeof g&&(g=""),this.pageTitle.innerHTML=g)},_createPanelUI:function(g,
a){this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var c=0;c<g.length;c++){var m=g[c];"ThemeCluster"===m.symbolData.clusterType&&this.updateThemeClusterSymbol(m,c);var f=a.getLayerInfoById(m.id);this._createLayerListItem(m,f)}if(!this.hidePanel){k.create("div",{"class":"expandArrow"},this.pageMain);for(var b in this.layerList)c=this.layerList[b],"ClusterLayer"!==c.type&&this.updateEnd.push(this.own(t(c.layerObject,
"update-end",l.hitch(this,this.onUpdateEnd))))}this.addMapLayers();this.legendNodes.push({node:this.pageHeader,styleProp:"background-color"});this.themeColorManager=new W({updateNodes:this.legendNodes,layerList:this.layerList,theme:this.appConfig.theme,stylename:this.styleName,ph:this.pageHeader,w:window})},updateThemeClusterSymbol:function(g,a){var c=g.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);
if(this._styleColor){var m=u.fromHex(this._styleColor),f=a+1,b=0<f?30*f:30,d=0===f%2,e=m.g,k=m.b,m=m.r-b;d&&(255<m?m-=255:0>m&&(m+=255));k-=b;0===f%3&&d&&(255<k?k-=255:0>k&&(k+=255));b=e-b;0===f%5&&d&&(255<b?b-=255:0>b&&(b+=255));c.clusterType="CustomCluster";c.clusterSymbol={color:[m,b,k,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},_createLayerListItem:function(g,a){for(var c=["ArcGISFeatureLayer","KML","ArcGISStreamLayer","CSV","GeoRSS"],
m=0;m<this.opLayers.length;m++){var f=this.opLayers[m];if(f.id===g.id||f.id===g.parentLayerID)if("ArcGISMapServiceLayer"===f.layerType){if(f=this._getSubLayerByURL(g.id),"undefined"!==typeof f){this.updateLayerList(f,g,"Feature Layer",a);break}}else if(-1<c.indexOf(f.layerType)||"undefined"===typeof f.layerType)if(f.layerObject&&f.id===g.id){this.updateLayerList(f,g,"Feature Layer",a);break}else if(f.featureCollection)for(var b=0;b<f.featureCollection.layers.length;b++){var d=f.featureCollection.layers[b];
if(d.id===g.id||f.id===g.id){this.updateLayerList(d,g,"Feature Collection",a);break}}else if(f.layerObject&&f.id===g.parentLayerID){var e,k;"GeoRSS"===f.type?(k="GeoRSS",e=f.layerObject.getFeatureLayers()):"KML"===f.type&&(k="KML",e=f.layerObject.getLayers());if(e)for(f=0;f<e.length;f++)if(b=e[f],b.id===g.id){this.updateLayerList(b,g,k,a);break}}}},removeOldClusterLayers:function(g){var a=[],c;for(c in this.layerList)if("ClusterLayer"===this.layerList[c].type){var b=0;b:for(;b<g.length;b++){var f=
g[b];if(f.id+this.UNIQUE_APPEND_VAL_CL===c){f.symbolData&&!f.symbolData.clusteringEnabled&&a.push(c);break b}}}if(0<a.length)for(var d in a)this.layerList.hasOwnProperty(a[d])&&(this.layerList[a[d]].layerObject.destroy(),delete this.layerList[a[d]])},addMapLayers:function(){for(var g=Object.keys(this.layerList).reverse(),a=0;a<g.length;a++){var c=g[a],b=this.layerList[c];b.type&&"ClusterLayer"===b.type&&-1===this.map.graphicsLayerIds.indexOf(c)&&this.map.addLayer(b.layerObject)}},_getSubLayerByURL:function(g){for(var a=
null,c=0;c<this.opLayerInfos.length;c++){var b=this.opLayerInfos[c];if(0<b.newSubLayers.length&&(a=this._recurseOpLayers(b.newSubLayers,g)))break}return a},_recurseOpLayers:function(g,a){for(var c=0;c<g.length;c++){var b=g[c];if(0<b.newSubLayers.length)this._recurseOpLayers(b.newSubLayers,a);else if(b.id===a)return b}},updateLayerList:function(g,a,c,b){var f=null,d=null,e=null,k=null,k=a.layerObject?a.layerObject:g,h=this._getInfoTemplate(k&&k.originOperLayer?k.originOperLayer:g);"ArcGISFeatureLayer"===
g.layerType?a.symbolData.clusteringEnabled?(f=this._getClusterLayer(a,g,b,c),this.layerList[f.id]={type:"ClusterLayer",layerObject:f,visible:!0,id:f.id,li:a,filter:this.supportsFilter&&b?b.getFilter():"1\x3d1",infoTemplate:h},this.hidePanel||this.own(t(f,"update-end",l.hitch(this,function(){this._loadList(this.layerList[f.id],!0)}))),this.numClusterLayers+=1):(g.parentLayerInfo&&g.parentLayerInfo.layerObject&&(d=g.parentLayerInfo.layerObject,e=a.id),f=g.layerObject,k=e?e:a.id,this.layerList[k]={type:d?
c:f.type,layerObject:d?d:f,visible:!0,pl:g,li:a,filter:this.supportsFilter&&b?b.getFilter():"1\x3d1",infoTemplate:h},this.updateRenderer(k)):"ArcGISStreamLayer"===g.layerType?(f=g.layerObject,this.layerList[f.id]={type:"StreamLayer",layerObject:f,visible:!0,id:f.id,filter:this.supportsFilter&&b?b.getFilter():"1\x3d1",infoTemplate:h}):a.symbolData.clusteringEnabled?(f=this._getClusterLayer(a,g,b,c),this.layerList[f.id]={type:"ClusterLayer",layerObject:f,visible:!0,id:f.id,li:a,filter:this.supportsFilter&&
b?b.getFilter():"1\x3d1",infoTemplate:h},this.hidePanel||this.own(t(f,"update-end",l.hitch(this,function(){this._loadList(this.layerList[f.id],!0)}))),this.numClusterLayers+=1):(g.parentLayerInfo&&g.parentLayerInfo.layerObject&&(d=g.parentLayerInfo.layerObject,e=d.visibleLayers?g.id:d.id),f=g.layerObject,k=e?e:g.id,this.layerList[k]={type:d?c:f?f.type:c,layerObject:d?d:f?f:g,visible:!0,pl:g,li:a,filter:this.supportsFilter&&b?b.getFilter():"1\x3d1",infoTemplate:h},this.updateRenderer(k));this.hidePanel||
this._addPanelItem(d?d:f?f:g,a)},updateRenderer:function(g){g=this.layerList[g];if("LayerSymbol"!==g.li.symbolData.symbolType){"undefined"===typeof g.li.orgRenderer&&(g.li.orgRenderer=g.layerObject.renderer?g.layerObject.renderer:g.li.renderer);var a=new Z(U.fromJson(g.li.symbolData.symbol));g.li.newRenderer=a;if(g.layerObject.setRenderer)g.layerObject.setRenderer(a);else if(g.layerObject.setLayerDrawingOptions){var c=[],b=new X;b.renderer=a;c[g.li.subLayerId]=b;g.layerObject.setLayerDrawingOptions(c)}else console.log("Error setting the new renderer...will use the default rendering of the layer");
g.layerObject.refresh()}},_addPanelItem:function(g,a){var c=g.visibleLayers?a.id:g.id,b=this.layerList[c].type,f=k.create("div",{"class":"rec solidBorder",id:"rec_"+c},this.pageMain);k.create("div",{"class":"expand expandDown",id:"exp_"+c},f);var e=k.create("div",{"class":"recIcon active",id:"recIcon_"+c},f);if(a.panelImageData&&-1<a.panelImageData.toString().indexOf("\x3cimg")){var h=document.createElement("div");h.innerHTML=a.panelImageData;h=new G(h.children[0].src,26,26);a.panelImageData=this._createImageDataDiv(h,
44,44,void 0,!0).innerHTML}e.innerHTML=a.panelImageData;x.set(e.firstChild,"border-radius","41px");var n;this.config.countEnabled?(n=k.create("div",{"class":"recLabel",id:"recLabel_"+c,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},f),d.setStyle(n,"top","20px"),n=k.create("div",{"class":"recNum",id:"recNum_"+c,innerHTML:""},f)):k.create("div",{"class":"recLabelNoCount",id:"recLabel_"+c,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},f);"ClusterLayer"===b?(g.node=n,this._addLegend(c,this.layerList[c]),g._updateNode(g.nodeCount)):
("StreamLayer"===b?(this.layerList[c].node=n,this.countFeatures(this.layerList[c])):this.layerList[c].node=n,this._addLegend(c,this.layerList[c]));t(e,"click",l.hitch(this,this._toggleLayer,this.layerList[c]));this.layerList[c].toggleLegend=t(f,"click",l.hitch(this,this._toggleLegend,this.layerList[c]));this.layerList[c].pl&&(this.layerList[c].pl.featureSet||this.countFeatures(this.layerList[c]))},_addLegend:function(g,a){a.legendNode=k.create("div",{"class":"legendLayer legendOff",id:"legend_"+g},
this.pageMain);"ClusterLayer"===a.type&&(a.layerObject.legendNode=a.legendNode)},_loadList:function(a,b){if(!this.hidePanel){var c=[],m=[],f=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;b&&this._addSearching(f);var d=[],e;a.layerObject&&a.layerObject.infoTemplate?e=a.layerObject.infoTemplate:a.li.infoTemplate&&(e=a.li.infoTemplate);if(e&&e.info){var k=e.info.fieldInfos;if("undefined"!==typeof k)for(var h=0;h<k.length;h++)k[h].visible&&d.push(k[h].fieldName)}if(a.li.symbolData&&(k=a.li.symbolData.featureDisplayOptions)){if(k.fields)for(h=
0;h<k.fields.length;h++)-1===d.indexOf(k.fields[h].name)&&d.push(k.fields[h].name);k.groupField&&-1===d.indexOf(k.groupField.name)&&d.push(k.groupField.name)}if(0===d.length||"undefined"===typeof e)d=["*"];"*"!==d[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===d.indexOf(a.layerObject.objectIdField)&&d.push(a.layerObject.objectIdField);if("ClusterLayer"===a.type){var n=[];if(a.layerObject.clusterGraphics){f=a.layerObject.clusterGraphics;for(e=0;e<f.length;e++)if(k=f[e],k.graphics&&0<k.graphics.length)for(h=
0;h<k.graphics.length;h++)n.push(k.graphics[h]);setTimeout(l.hitch(this,function(){this._updateList(n,a.legendNode,a.layerObject.node,d,b,a)}),100)}else this._removeSearching(f,!0)}f=["StreamLayer","GeoRSS","KML","Feature Layer"];if("ClusterLayer"!==a.type){if(a.pl&&a.pl.featureSet){this.getFeatures(a,d,b);return}if(-1<f.indexOf(a.type)||"CSV"===a.pl.type){this.getFeatures(a,d,b);return}}if(a.li&&(a.li.url&&"ClusterLayer"!==a.type&&"undefined"===typeof a.queryFeatures)&&(e=a.li.url,-1<e.indexOf("MapServer")||
-1<e.indexOf("FeatureServer")))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),f=new D,f.where=a.filter?a.filter:"1\x3d1",f.geometry=this.map.extent,f.returnGeometry=!0,f.outFields=d,e=new L(e),c.push(e.execute(f)),m.push({node:a.node,legendNode:a.legendNode,fields:d,updateCount:b,li:a.li});0<c.length&&(this.promises=z(c).then(l.hitch(this,function(a){this.promises=void 0;if(a)for(var g=0;g<a.length;g++)if(a[g]){var c=m[g];this._updateList(a[g].features,c.legendNode,c.node,
c.fields,c.updateCount,c.li)}})))}},_addSearching:function(g){a.contains("exp_"+g,"expandDown")&&(a.remove("exp_"+g,"expandDown"),a.add("exp_"+g,"expandSearching"));a.contains("exp_"+g,"expandUp")&&(a.remove("exp_"+g,"expandUp"),a.add("exp_"+g,"expandSearching"))},_removeSearching:function(g,b){a.contains("exp_"+g,"expandSearching")&&(a.remove("exp_"+g,"expandSearching"),a.add("exp_"+g,b?"expandUp":"expandDown"))},_getClusterLayer:function(a,b,c,m){var f=b.layerObject?b.layerObject:b,d=a.infoTemplate,
e=f&&f.originOperLayer?f.originOperLayer:b.parentLayerInfo;b=null;b=a.id+this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(b)||-1<this.map._layers.indexOf(b)?(b=this.map.getLayer(b),f=m=!1,JSON.stringify(b.symbolData)!==JSON.stringify(a.symbolData)&&(b.symbolData=a.symbolData,b.countColor=a.symbolData._highLightColor,f=!0),c=k.toDom(a.panelImageData),JSON.stringify(b.icon)!==JSON.stringify(c.src)&&(b.icon=c.src,f=!0),k.destroy(c.id),b.displayFeatureCount=a.symbolData.displayFeatureCount,
b.refresh!==a.refresh&&(b.refresh=a.refresh,m=!0),f&&b._setupSymbols(),b.countEnabled=this.config.countEnabled,b.hidePanel=this.hidePanel,m?b.refreshFeatures(b.url):f&&b.clusterFeatures()):b=new aa({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:b,map:this.map,node:n.byId("recNum_"+b),legendNode:n.byId("legend_"+b),infoTemplate:"undefined"!==typeof f.infoTemplate?f.infoTemplate:d,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:f,lyrInfo:a,lyrType:m,_styleColor:this._styleColor,
originOperLayer:e,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:this.supportsFilter&&c?c.getFilter():"1\x3d1"});return b},_createImageDataDiv:function(a,b,c,m,f){var d;if(a){d=b;var e=c;if(a.height&&a.width){var h;if(a.height>a.width)h=a.width/a.height,e=b*h;else if(a.width===a.height||a.width>a.height)e=b,h=a.width/a.height,d=0<h?c*h:c}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(f?e-0.25*e:e),a.setHeight(f?d-0.25*d:d)):a.setWidth(2):"undefined"!==
typeof a.size&&20<a.size&&a.setSize(20);d=k.create("div",{"class":"imageDataGFX"},m);m=B.createSurface(d,b,c);a=U.getShapeDescriptors(a);m.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:b/2,dy:c/2})}return d},_updateUI:function(a){this.styleName=a;0<Object.keys(this.layerList).length&&(this.themeColorManager=new W({updateNodes:this.legendNodes,layerList:this.layerList,theme:this.appConfig.theme,stylename:a,ph:this.pageHeader,w:window}))},_toggleLayer:function(g,
b){b.stopPropagation();this.map.infoWindow.hide();var c=g.id?g.id:g.layerObject.id,d=this.layerList[c];d||(d=this.layerList[c]);d||(g.pl&&(c=g.pl.id),d=this.layerList[c]);if(d){var f=!0;d.layerObject.hasOwnProperty("visibleAtMapScale")&&(f=d.layerObject.visibleAtMapScale);var e=!1;d.li&&d.li.hasOwnProperty("subLayerId")&&(e="undefined"!==typeof d.li.subLayerId);var k=n.byId("recLabel_"+c);if(a.contains("recIcon_"+c,"active"))a.remove("recIcon_"+c,"active"),e&&"ClusterLayer"!==d.type?(e=d.layerObject.visibleLayers,
f=e.indexOf(d.li.subLayerId),-1<f&&e.splice(f,1),d.layerObject.setVisibleLayers(e),d.layerObject.setVisibility(!0)):d&&(d.layerObject.setVisibility(!1),"undefined"!==typeof d.pl&&(d.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(c)&&(e=this.map.getLayer(c),e.setVisibility(!1)))),this.layerList[c].visible=!1,this.layerList[c].parentLayerVisible=!1,"ClusterLayer"===this.layerList[c].type&&(this.layerList[c].layerObject.parentLayerVisible=!1),this._clearList(this.layerList[c]),this.config.countEnabled&&
a.contains("recNum_"+c,"recNum")&&(a.remove("recNum_"+c,"recNum"),a.add("recNum_"+c,"recNumInActive")),k&&k.firstChild&&a.add(k.firstChild,"inActive"),a.contains("exp_"+c,"expandInActive")||a.add("exp_"+c,"expandInActive"),d.legendOpen&&a.contains("legend_"+c,"legendOn")&&(this.layerList[c].legendOpen=!1,a.remove("legend_"+c,"legendOn"),a.add("legend_"+c,"legendOff"),a.contains("exp_"+c,"expandUp")&&(a.remove("exp_"+c,"expandUp"),a.add("exp_"+c,"expandDown"))),d.toggleLegend&&d.toggleLegend.remove(),
a.contains("rec_"+c,"rec")&&a.add("rec_"+c,"recDefault");else{a.add("recIcon_"+c,"active");e&&"ClusterLayer"!==d.type?(e=d.layerObject.visibleLayers,e.push(d.li.subLayerId),d.layerObject.setVisibleLayers(e),d.layerObject.setVisibility(!0)):d&&(d.layerObject.setVisibility(!0),"ClusterLayer"===d.type&&(d.layerObject.handleMapExtentChange({levelChange:!0}),d.layerObject.flashFeatures()),this.layerList[c].visible=!0,this.layerList[c].parentLayerVisible=!0,"undefined"!==typeof d.pl&&(d.pl.visibility=!0,
-1<this.map.graphicsLayerIds.indexOf(c)&&(e=this.map.getLayer(c),e.setVisibility(!0))));this.layerList[c].visible=!0;this.layerList[c].parentLayerVisible=!0;"ClusterLayer"===d.type&&(this.layerList[c].layerObject.parentLayerVisible=!0);this._loadList(d,!0);this.config.countEnabled&&a.contains("recNum_"+c,"recNumInActive")&&(a.remove("recNum_"+c,"recNumInActive"),a.add("recNum_"+c,"recNum"));k&&k.firstChild&&a.remove(k.firstChild,"inActive");a.contains("exp_"+c,"expandInActive")&&f&&a.remove("exp_"+
c,"expandInActive");d.toggleLegend&&d.toggleLegend.remove();if(k=n.byId("rec_"+c))d.toggleLegend=t(k,"click",l.hitch(this,this._toggleLegend,d));a.contains("rec_"+c,"recDefault")&&a.remove("rec_"+c,"recDefault")}}return!1},_toggleLegend:function(g,b){if("thumb2"!==b.currentTarget.className&&"recIcon"!==b.currentTarget.className){var c=g.layerObject.id in this.layerList?g.layerObject.id:g.li.id;a.contains("legend_"+c,"legendOff")?(this._addSearching(c),this.layerList[c].legendOpen=!0,"undefined"===
typeof this.layerList[c].li.layerListExtentChanged&&(this.layerList[c].li.layerListExtentChanged=!0),this.layerList[c].li.layerListExtentChanged?setTimeout(l.hitch(this,function(){this._loadList(g,!1)}),500):this._removeSearching(c,!0),a.remove("legend_"+c,"legendOff"),a.add("legend_"+c,"legendOn")):a.contains("legend_"+c,"legendOn")&&(this.layerList[c].legendOpen=!1,a.contains("exp_"+c,"expandUp")&&(a.remove("exp_"+c,"expandUp"),a.add("exp_"+c,"expandDown")),a.remove("legend_"+c,"legendOn"),a.add("legend_"+
c,"legendOff"))}b.stopPropagation()},_toggleGroup:function(g,b){var c=b.currentTarget.id.slice(0,-2),e=!0;b.target.parentNode&&(""!==b.target.parentNode.id&&a.contains(b.target.parentNode.id,"featureItem")&&(e=!1),""!==b.target.id&&a.contains(b.target.id,"featureItem")&&(e=!1));if(e){var e=g.layerObject.id in this.layerList?g.layerObject.id:g.li.id,f=document.getElementById(b.currentTarget.id);a.contains(c,"groupOff")?(this.layerList[e].openGroups&&0<this.layerList[e].openGroups.length?-1===this.layerList[e].openGroups.indexOf(c)&&
this.layerList[e].openGroups.push(c):this.layerList[e].openGroups=[c],a.remove(c,"groupOff"),a.add(c,"groupOn"),this.layerList[e].groupOpen=!0,-1<f.childNodes[0].childNodes[2].childNodes[0].className.indexOf("groupItemImage")&&(d.removeClass(f.childNodes[0].childNodes[2].childNodes[0],"groupItemImageDown"),d.addClass(f.childNodes[0].childNodes[2].childNodes[0],"groupItemImageUp"))):a.contains(c,"groupOn")&&(a.remove(c,"groupOn"),a.add(c,"groupOff"),this.layerList[e].openGroups&&0<this.layerList[e].openGroups.length?
(c=this.layerList[e].openGroups.indexOf(c),-1<c&&this.layerList[e].openGroups.splice(c,1),0===this.layerList[e].openGroups.length&&(this.layerList[e].groupOpen=!1)):this.layerList[e].groupOpen=!1,-1<f.childNodes[0].childNodes[2].childNodes[0].className.indexOf("groupItemImage")&&(d.removeClass(f.childNodes[0].childNodes[2].childNodes[0],"groupItemImageUp"),d.addClass(b.currentTarget.childNodes[0].childNodes[2].childNodes[0],"groupItemImageDown")))}},onAppConfigChanged:function(a,b,c){switch(b){case "themeChange":case "layoutChange":this.destroy();
break;case "styleChange":this.hidePanel||this._updateUI(c);this._updateStyleColor(c);break;case "widgetChange":this.widgetChange=!0;c&&c.config.layerInfos&&this.removeOldClusterLayers(c.config.layerInfos);break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(l.hitch(this,function(){var a=window.getComputedStyle(this.pageHeader,null).getPropertyValue("background-color");this._styleColor=R.fromRgb(a).toHex();for(var g in this.layerList)a=this.layerList[g],"ClusterLayer"===
a.type&&a.layerObject.setStyleColor(this._styleColor)}),500)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var b=this.layerList[a];if("ClusterLayer"===b.type){var c=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(c=!this.continuousRefreshEnabled);c&&(b.layerObject._clear(),this.map.removeLayer(b.layerObject))}}this.layerList={}}},setPosition:function(a,b){var c;this.hidePanel?(this.inherited(arguments),this.position=c={right:"0px",bottom:"0px",top:"0px",height:"0px",
"z-index":"auto"},c=p.getPositionStyle(this.position),c.position="absolute",c.width="",b=this.map.id,d.place(this.domNode,b),d.setStyle(this.domNode,c)):"BoxTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=c={right:"0px",bottom:"0px",top:"0px",height:"auto","z-index":"auto"},c=p.getPositionStyle(this.position),c.position="absolute",b=this.map.id,d.place(this.domNode,b),c.width="",d.setStyle(this.domNode,c),x.set(this.pageContent,"bottom","60px")):("DartTheme"===this.appConfig.theme.name?
(this.inherited(arguments),this.position=c={right:"0px",bottom:"80px",top:"0px",height:"auto","z-index":"auto"},c=p.getPositionStyle(this.position),c.position="absolute",c.width="",b=this.map.id,d.place(this.domNode,b)):"LaunchpadTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=c={right:"0px",bottom:"130px",top:"70px",height:"auto","z-index":"auto"},c=p.getPositionStyle(this.position),c.position="absolute",c.width="",b=this.map.id,d.place(this.domNode,b)):470>=window.innerWidth?
(this.position=c={right:"0px",bottom:"0px",height:"none","z-index":"auto",relativeTo:"browser"},c=p.getPositionStyle(this.position),c.position="absolute",c.width="",d.place(this.domNode,window.jimuConfig.layoutId),n.byId("map").style.bottom=window.innerHeight/2+"px"):(this.position=c={right:"0px",bottom:"0px",height:"none","z-index":"auto"},c=p.getPositionStyle(this.position),c.position="absolute",c.width="",d.place(this.domNode,this.map.id)),d.setStyle(this.domNode,c))},_close:function(){this.widgetManager.closeWidget(this.id)},
onClose:function(){this.inherited(arguments);for(var a in this.layerList){var b=this.layerList[a];b.li&&b.li.orgRenderer&&(b.layerObject.setRenderer?b.layerObject.setRenderer(b.li.orgRenderer):b.layerObject.setLayerDrawingOptions?b.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),b.layerObject.refresh())}a=!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=
0,clearInterval(this.refreshInterval),this.refreshInterval=0);!this.hidePanel&&"undefined"!==typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0);this._resetMapDiv()},_resetMapDiv:function(){n.byId("map").style.bottom="0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},onUpdateEnd:function(a){a=this.layerList.hasOwnProperty(a.target.id)?a.target.id:a.target.id+"_CL";if((a=this.layerList[a])&&a.visible)a.updateList?
this._loadList(a,a.updateList):(this.config.countEnabled&&this.countFeatures(a),this._loadList(a,!0))},_mapExtentChange:function(){var b=this.config.countEnabled,e=[],c=[],k;for(k in this.layerList){var f=this.layerList[k],h=!0;f.layerObject.hasOwnProperty("visibleAtMapScale")&&(h=f.layerObject.visibleAtMapScale);if(!f.legendOpen||f.groupEnabled&&!f.groupOpen)if(this._clearList(f),f.li&&(f.li.layerListExtentChanged=!0),f.visible&&h){if(f.li&&f.li.url&&"ClusterLayer"!==f.type&&"undefined"===typeof f.layerObject.queryCount){var l=
f.li.url;if(-1<l.indexOf("MapServer")||-1<l.indexOf("FeatureServer"))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),h=new D,h.where=f.filter?f.filter:"1\x3d1",h.geometry=this.map.extent,h.returnGeometry=!1,l=new L(l),e.push(l.executeForIds(h)),b?c.push(f.node):c.push(f.legendNode)}"ClusterLayer"===f.type&&(f.layerObject.initalLoad&&this.config.countEnabled)&&f.layerObject._updateNode(f.layerObject.node.innerHTML);h=["StreamLayer","GeoRSS","KML"];"ClusterLayer"!==f.type&&
("undefined"===typeof f.layerObject?console.log("layer object not known"):f.pl&&f.pl.featureSet?this.countFeatures(f):-1<h.indexOf(f.type)||"CSV"===f.pl.type?this.countFeatures(f):f.layerObject._autoSnapshot&&this.countFeatures(f))}else h||this._updateList([],f.legendNode,f.node,[],!0,f);else f.visible&&h?(f.updateList=!0,this._loadList(f,f.updateList)):this._updateList([],f.legendNode,f.node,[],!0,f)}0<e.length&&(this.promises=z(e).then(function(f){this.promises=void 0;if(f)for(var e=0;e<f.length;e++){var k;
f[e]?(a.contains(c[e].id,"searching")&&a.remove(c[e].id,"searching"),k=f[e].length):k=0;var m;b?(c[e].innerHTML=p.localizeNumber(k),m=c[e].parentNode):m=c[e].previousSibling;var h;-1<m.id.indexOf("rec_")&&(h=m.id.replace("rec_",""),h=n.byId("exp_"+h));0===k?(m&&(d.addClass(m,"recDefault"),d.addClass(m,"inActive")),h&&d.addClass(h,"expandInActive")):(m&&(d.removeClass(m,"recDefault"),d.removeClass(m,"inActive")),h&&d.removeClass(h,"expandInActive"))}}))},getFeatures:function(a,b,c){var d=a.layerObject,
f=a.legendNode,e=a.node,k=!0;d.hasOwnProperty("visibleAtMapScale")&&(k=d.visibleAtMapScale);var h=[],n=new D;n.geometry=this.map.extent;n.outFields=b;n.returnGeometry=!0;if(a.visible&&k)if(d.queryFeatures)h.push(d.queryFeatures(n));else{if(d=a.li.url,-1<d.indexOf("MapServer")||-1<d.indexOf("FeatureServer"))d=new L(d),n.where=a.filter?a.filter:"1\x3d1",h.push(d.execute(n)),h.push(d.executeForIds(n))}else this._updateList([],a.legendNode,a.node,[],!0,a);0<h.length&&(this.featurePromises&&(this.featurePromises.cancel("redundant",
!1),this.featurePromises=void 0),z(h).then(l.hitch(this,function(d){var h;e&&(h=this.config.countEnabled?e.parentNode:e.previousSibling);d&&d[0]?d[0].features?setTimeout(l.hitch(this,function(){this._updateList(d[0].features,f,e,b,c,a);this.config.countEnabled&&1<d.length&&1E3<d[1].length&&(e.innerHTML=p.localizeNumber(d[1].length))}),100):0<d[0].length&&k?this._updateList(d[0],a.legendNode,a.node,[],!0,a,!0):this._updateList([],a.legendNode,a.node,[],!0,a):(this.config.countEnabled&&(e.innerHTML=
p.localizeNumber(0)),this.updateExpand(h,!0));this._removeSearching(a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,a.legendOpen)})))},_getInfoTemplate:function(a){var b;b=a.parentLayerInfo?a.parentLayerInfo:a;if(b.controlPopupInfo&&(a=b.controlPopupInfo.infoTemplates)&&b.layerObject&&b.layerObject.url)if(b=b.layerObject.url,b=b.split("/").pop())if(a.indexOf){if(-1<a.indexOf(b))return a[b].infoTemplate}else if(a.hasOwnProperty(b))return a[b].infoTemplate},_clearList:function(a){a.legendNode&&
(a.legendNode.innerHTML="")},_updateList:function(b,d,c,e,f,h,n){"ClusterLayer"===h.type&&h.layerObject.node&&a.contains(h.layerObject.node.id,"searching")&&a.remove(h.layerObject.node.id,"searching");var q;if("undefined"!==typeof h.li.subLayerId){var r=h.layerObject.infoTemplates;r&&r.hasOwnProperty(h.li.subLayerId)&&(q=r[h.li.subLayerId].infoTemplate)}r=h.li.symbolData.featureDisplayOptions;d.innerHTML="";f&&(c&&this.config.countEnabled)&&(c.innerHTML=p.localizeNumber(b.length));this.updateExpand(this.config.countEnabled?
c.parentNode:d.previousSibling,0===b.length);if(!n){if(0<b.length){var u;"ClusterLayer"===h.type?u=h.layerObject.renderer:b[0]._graphicsLayer?u=b[0]._graphicsLayer.renderer:h.li.renderer&&(u=$.fromJson(h.li.renderer));f=[];n=[];c=[];for(var w=0;w<b.length;w++){var v=b[w];"undefined"===typeof v.infoTemplate&&q&&(v.infoTemplate=q);var M,z;v._layer&&v._layer.objectIdField?(M=v.attributes[v._layer.objectIdField],z=v._layer.objectIdField):h.li&&h.li.oidFieldName?(M=v.attributes[h.li.oidFieldName.name],
z=h.li.oidFieldName.name):h.layerObject&&h.layerObject.objectIdField?(M=v.attributes[h.layerObject.objectIdField],z=h.layerObject.objectIdField):M=d.id+w;var B,D=!1;"*"===e[0]?B=v.attributes:(B=e,D=!0);var A=this.getDisplayString(v,h,B,r,z,D),E,J,x,y;if(r.groupEnabled){E=r.groupField;var C="group_"+h.li.id+"_"+E.name+"_"+v.attributes[E.name],K=!0,H;0<f.length&&N.forEach(f,function(a){C===a.id&&v.attributes[E.name]===a.value&&(K=!1,H=a.node,x=a.parent)});if(K){x=k.create("div",{"class":"groupItem",
id:C+"_c"});J=k.create("div",{"class":"groupItemTitle",id:C+"_t"},x);var Q="",F=E.name+": ";""!==E.label&&(F=Q=E.label+": ");": "===Q&&(F=Q="");var P=v.attributes[E.name];y=P;this._checkDateField(h,E.name)&&(y=this.formatDateValue(P,E.name,h));var L=this._checkDomainField(h,E.name);L&&(y=this.formatDomainValue(P,L));k.create("div",{"class":"groupField",innerHTML:Q+y,title:F+y},J);Q=!1;h.openGroups&&0<h.openGroups.length&&(Q=-1<h.openGroups.indexOf(C));y=k.create("div",{"class":"groupCountLabel"},
J);J=k.create("div",{"class":"expandImageContainer"},J);F="groupItemImage";F+=Q?" groupItemImageUp":" groupItemImageDown";k.create("div",{"class":F},J);F="groupItem";F=h.groupOpen&&Q?F+" groupOn":F+" groupOff";J=k.create("div",{"class":F,id:C},x);f.push({id:"group_"+h.li.id+"_"+E.name+"_"+P,node:J,parent:x,value:P});n.push({value:P,node:x,countNode:y,count:1});t(x,"click",l.hitch(this,this._toggleGroup,h))}else n.filter(function(a){if(a.node.id===H.id+"_c")return a})[0].count+=1,J=H}M=k.create("div",
{"class":"featureItem",id:"feature_"+h.li.id+"_"+M});P=!1;h.li&&h.li.symbolData&&(P="CustomSymbol"===h.li.symbolData.symbolType);var G;u&&u.getSymbol?G=u.getSymbol(v):v.symbol&&(G=U.fromJson(v.symbol));G&&this._createImageDataDiv(l.clone(G),30,30,M,P);v=this.updateDomainValues(v,D,B,h);t(M,"click",l.hitch(this,this._panToFeature,v));-1<A.indexOf(" - ")&&(A=A.slice(0,-3));k.create("div",{style:window.isRTL?"padding: 7px 45px 5px 5px; text-align: right;":"padding: 7px 5px 5px 45px; text-align: left;",
innerHTML:A,title:A},M);c.push({node:M,updateNode:J?J:d})}if(0<n.length){b=n.sort(function(a,b){return"undefined"===typeof a.value?b.value:"undefined"===typeof b.value?a.value:isNaN(a.value)?a.value.localeCompare(b.value):parseFloat(a.value)-parseFloat(b.value)});var R=this.config.countEnabled;N.forEach(b,function(a){R&&(a.countNode.innerHTML=p.localizeNumber(a.count));d.appendChild(a.node)})}0<c.length&&N.forEach(c,function(a){k.place(a.node,a.updateNode)})}h.li.layerListExtentChanged=!1;this._removeSearching(h.layerObject.id in
this.layerList?h.layerObject.id:h.li.id,h.legendOpen)}},updateDomainValues:function(a,b,c,d){var f,e,h,k;for(k in c)h=b?c[k]:k,f=this._checkDomainField(d,h),e=a.attributes[h],f&&(a.attributes[h]=this.formatDomainValue(e,f));return a},updateExpand:function(a,b){if("undefined"!==typeof a){var c;-1<a.id.indexOf("rec_")&&(c=a.id.replace("rec_",""),c=n.byId("exp_"+c));b?(a&&(d.addClass(a,"recDefault"),d.addClass(a,"inActive")),c&&d.addClass(c,"expandInActive")):(a&&(d.removeClass(a,"recDefault"),d.removeClass(a,
"inActive")),c&&d.removeClass(c,"expandInActive"))}},getDisplayString:function(a,b,c,d,f,e){var h,k,l,n="",p,r,q,t,u;for(u in c)if(q=e?c[u]:u,k=this._checkDateField(b,q),l=this._checkDomainField(b,q),t=this._checkAliasName(b,q),h=!0,d.fields&&0<d.fields.length&&(h=this._checkDisplayField(d.fields,q)),p=""!==h.label?": ":" ",r=a.attributes[q],k&&(r=this.formatDateValue(r,q,b)),l&&(r=this.formatDomainValue(r,l)),t&&(q=t),h&&d.fields&&0<d.fields.length)n+=h.label+p+r+" - ";else if(h)if(f&&q!==f){n+=
q+p+r;break}else if("undefined"===typeof f){n+=q+p+r;break}return n},formatDomainValue:function(a,b){if(b&&b.codedValues)for(var c=b.codedValues,d=0;d<c.length;d++){var f=c[d];if(f.code===a)return f.name}},formatDateValue:function(a,b,c){if(a){var d,f;c.layerObject&&c.layerObject.infoTemplate?f=c.layerObject.infoTemplate:c.li&&c.li.infoTemplate&&(f=c.li.infoTemplate);if(f&&(c=f._fieldsMap))for(var e in c)if(c[e].fieldName===b){d=c[e].format;break}"undefined"===typeof d&&(d={dateFormat:"shortDate"});
return p.fieldFormatter.getFormattedDate(new Date(a),d)}return""},_checkAliasName:function(a,b){var c=a.li.fields;if(c){for(var d=0;d<c.length;d++){var f=c[d];if(f.name===b)return"undefined"!==typeof f.alias?f.alias:!1}return!1}},_checkDomainField:function(a,b){var c=a.li.fields;if(c){for(var d=0;d<c.length;d++){var f=c[d];if(f.name===b)return"undefined"!==typeof f.domain?f.domain:!1}return!1}},_checkDateField:function(a,b){var c=a.li.fields;if(c){for(var d=0;d<c.length;d++){var f=c[d];if(f.name===
b){if("esriFieldTypeDate"===f.type)return!0;break}}return!1}},_checkDisplayField:function(a,b){var c=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===b)return a[d];c=!1}return c},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b])},_flashFeature:function(a){var b;if(a.geometry){var c=R.fromHex(this._styleColor),d=l.clone(c);d.a=0.4;switch(a.geometry.type){case "point":b=new r(r.STYLE_CIRCLE,15,new C(C.STYLE_SOLID,c,1),d);break;case "polyline":b=new C(C.STYLE_SOLID,c,3);
break;case "polygon":b=new H(H.STYLE_DIAGONAL_CROSS,new C(C.STYLE_SOLID,c,2),d)}}a=new h(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())y.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type)var c=b.paths[Math.ceil(b.paths.length/2)-1],c=c[Math.ceil((c.length-
1)/2)],b=new T(c[0],c[1],b.spatialReference);"point"!==b.type&&(b=b.getExtent().getCenter());this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),this.map.infoWindow.select(0),this.map.infoWindow.show(b)}},countFeatures:function(a){var b=a.layerObject,c=this.config.countEnabled?a.node:a.legendNode;a=new D;a.geometry=this.map.extent;b.queryCount&&b.visible&&b.queryCount(a,l.hitch(this,function(a){if(c){var b;this.config.countEnabled?(c.innerHTML=
p.localizeNumber(a),b=c.parentNode):b=c.previousSibling;this.updateExpand(b,0===a)}}))}})});